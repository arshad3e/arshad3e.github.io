<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arshad Shaik | Galactic Architect</title>
    <style>
        /* --- FONTS & RESET --- */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500&display=swap');
        
        body { margin: 0; overflow: hidden; background-color: #000005; font-family: 'Rajdhani', sans-serif; color: white; }
        canvas { display: block; }

        :root { --cyan: #00f3ff; --gold: #ffd700; --alert: #ff3333; }

        /* --- UI LAYER --- */
        #identity {
            position: fixed; top: 30px; left: 30px; z-index: 50; pointer-events: none;
        }
        #identity h1 {
            font-family: 'Orbitron', sans-serif; font-size: 1.8rem; letter-spacing: 4px; margin: 0;
            background: linear-gradient(90deg, #fff, var(--cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.4));
        }
        #identity p {
            font-size: 0.9rem; letter-spacing: 3px; color: #aaddff; margin: 8px 0 0 0;
            border-left: 3px solid var(--cyan); padding-left: 12px;
            text-transform: uppercase; opacity: 0.8;
        }

        /* --- HUD --- */
        #hud-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        
        /* PLANET LABELS */
        .planet-tracker {
            position: absolute; display: flex; align-items: flex-end;
            transform: translate(-50%, -50%); opacity: 0; transition: opacity 0.5s;
        }
        .tracker-line {
            width: 1px; height: 60px; background: linear-gradient(to top, var(--cyan), transparent);
            transform: rotate(-35deg); transform-origin: bottom center;
        }
        .tracker-label {
            border: 1px solid var(--cyan); background: rgba(0, 5, 10, 0.85);
            padding: 6px 16px; font-family: 'Orbitron'; font-size: 11px; letter-spacing: 2px;
            color: var(--cyan); box-shadow: 0 0 20px rgba(0, 243, 255, 0.15);
            margin-bottom: 50px; margin-left: -25px;
            cursor: pointer; pointer-events: auto; transition: 0.3s;
        }
        .tracker-label:hover { background: var(--cyan); color: #000; box-shadow: 0 0 30px rgba(0, 243, 255, 0.6); }

        /* COMET LABELS */
        .comet-tracker {
            position: absolute; transform: translate(-50%, -50%); opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .comet-label {
            background: rgba(255, 50, 0, 0.9); color: white; padding: 6px 14px;
            font-family: 'Orbitron'; font-size: 12px; letter-spacing: 1px; border-radius: 4px;
            box-shadow: 0 0 20px rgba(255, 100, 0, 0.8); white-space: nowrap; border: 1px solid white;
        }
        .comet-tracker.blue .comet-label { background: rgba(0, 119, 181, 0.9); box-shadow: 0 0 20px rgba(0, 119, 181, 0.8); }

        /* --- MODAL --- */
        #modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
            z-index: 100; opacity: 0; pointer-events: none; transition: 0.4s;
            display: flex; justify-content: center; align-items: center;
        }
        #modal.active { opacity: 1; pointer-events: auto; }
        .modal-card {
            width: 800px; max-width: 90%; max-height: 85vh;
            background: rgba(5, 8, 12, 0.95); border: 1px solid var(--cyan);
            box-shadow: 0 0 60px rgba(0, 243, 255, 0.1);
            display: flex; flex-direction: column;
            transform: scale(0.95) translateY(20px); transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #modal.active .modal-card { transform: scale(1) translateY(0); }
        .modal-header {
            padding: 25px 35px; border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(90deg, rgba(0, 243, 255, 0.05), transparent);
        }
        .modal-header h2 { font-family: 'Orbitron'; margin: 0; font-size: 1.8rem; color: var(--cyan); letter-spacing: 2px; }
        .close-btn {
            background: none; border: 1px solid #444; width: 35px; height: 35px; border-radius: 50%;
            color: #888; font-size: 1.2rem; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center;
        }
        .close-btn:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.1); }
        .modal-body { padding: 40px; overflow-y: auto; color: #ccc; font-size: 1.1rem; line-height: 1.7; }
        .modal-body h3 { color: #fff; border-left: 3px solid var(--cyan); padding-left: 15px; margin-top: 35px; margin-bottom: 15px; }
        .modal-body ul { list-style: none; padding: 0; }
        .modal-body li { margin-bottom: 12px; padding-left: 20px; position: relative; }
        .modal-body li::before { content: '►'; color: var(--cyan); position: absolute; left: 0; font-size: 0.8em; top: 4px; }
        .modal-body a { color: var(--cyan); text-decoration: none; border-bottom: 1px dotted var(--cyan); transition: 0.3s; }
        .modal-body a:hover { background: rgba(0, 243, 255, 0.1); }

        /* --- LOADER --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; transition: opacity 1.5s;
        }
        .loader-text { color: var(--cyan); font-family: 'Orbitron'; letter-spacing: 6px; font-size: 1.2rem; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        #data-source { display: none; }
    </style>
</head>
<body>

    <!-- LOADER -->
    <div id="loader">
        <div class="loader-text">IGNITING COMETS...</div>
    </div>

    <!-- CANVAS -->
    <div id="canvas-container"></div>

    <!-- IDENTITY -->
    <div id="identity">
        <h1>Arshad Shaik</h1>
    </div>

    <!-- HUD LAYER -->
    <div id="hud-layer"></div>

    <!-- MODAL -->
    <div id="modal">
        <div class="modal-card">
            <div class="modal-header">
                <h2 id="modal-title">TITLE</h2>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <!-- DATA -->
    <div id="data-source">
        <div id="data-about">
            <p>I specialize in the <strong>industrialization of automotive software</strong>. Navigating the chaotic intersection of hardware constraints, timelines, and architectural purity.</p>
            <p>Currently overseeing 14 OEM car lines, bridging high-level architecture with low-level embedded reality.</p>
        </div>
        <div id="data-skills">
            <h3>Core Engineering</h3>
            <ul>
                <li>C++ / Embedded C / Rust</li>
                <li>QNX Neutrino / Embedded Linux</li>
                <li>Real-Time Operating Systems (RTOS)</li>
            </ul>
            <h3>Infrastructure</h3>
            <ul>
                <li>Kubernetes (K8s, K3s)</li>
                <li>Docker / Containerization</li>
                <li>Terraform / IaC</li>
            </ul>
        </div>
        <div id="data-experience">
            <h3>Robert Bosch LLC (2019 - Present)</h3>
            <p><strong>Software Launch Manager & Architect</strong></p>
            <p>Leading global teams to deliver next-gen Cockpit Domain Controllers. Responsible for system stability and launch readiness.</p>
            <h3>Ford Motor Company (2017 - 2019)</h3>
            <p><strong>Solution Architect</strong></p>
            <p>Designed connected vehicle platforms and cloud standards.</p>
        </div>
        <div id="data-projects">
            <h3>Luxury EV Infotainment</h3>
            <p>Architected boot sequence optimization for a flagship EV, reducing cold boot time by 40%.</p>
            <h3>Edge Computing</h3>
            <p>Deployed K3s (Kubernetes) on vehicle hardware to manage microservices.</p>
        </div>
        <div id="data-blog">
            <h3>Latest Posts</h3>
            <ul>
                <li><a href="#">The Shift to Zone Architecture</a></li>
                <li><a href="#">Why Rust is Eating C++</a></li>
            </ul>
        </div>
        <div id="data-contact">
            <h3>Secure Channels</h3>
            <p><strong>Email:</strong> arshad.3e@gmail.com</p>
            <p><strong>LinkedIn:</strong> <a href="#">linkedin.com/in/arshad-shaik</a></p>
        </div>
    </div>

    <!-- THREE.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- CONFIG ---
        const CONFIG = {
            camZ: 250,
            orbitSpeed: 0.05,
            sunSize: 22,
        };

        const PLANETS = [
            { id: 'about', name: 'ABOUT', radius: 5, dist: 65, speed: 1.0, color: 0xaa4444, type: 'rock' },
            { id: 'skills', name: 'SKILLS', radius: 8, dist: 95, speed: 0.7, color: 0xffcc00, type: 'gas' },
            { id: 'experience', name: 'EXPERIENCE', radius: 7, dist: 135, speed: 0.5, color: 0x0088ff, type: 'earth' },
            { id: 'projects', name: 'PROJECTS', radius: 6, dist: 175, speed: 0.4, color: 0xff5522, type: 'rock' },
            { id: 'blog', name: 'BLOG', radius: 14, dist: 230, speed: 0.25, color: 0xddbb99, type: 'jupiter' },
            { id: 'contact', name: 'CONTACT', radius: 11, dist: 290, speed: 0.15, color: 0x88aaff, type: 'ice' }
        ];

        // Adjusted distances to ensure comets are visible and orbit fast
        const COMETS = [
            { id: 'linkedin', label: 'LINKEDIN', url: 'https://www.linkedin.com/in/arshad-shaik-software-engineer/', color: 0x0077b5, tailColor: '#0077b5', distX: 160, distZ: 110, offset: 0 },
            { id: 'github', label: 'GITHUB', url: 'https://github.com/arshad3e', color: 0xffffff, tailColor: '#ffaa00', distX: 210, distZ: 140, offset: 3 }
        ];

        let scene, camera, renderer, clock;
        let sunMesh, planetsMesh = [], cometsMesh = [];
        let starGroups = [];
        let raycaster, mouse;
        let isPaused = false;

        // --- SHADERS ---
        const sunVertex = `varying vec2 vUv; varying vec3 vNormal; void main() { vUv = uv; vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`;
        const sunFragment = `
            uniform float time; varying vec2 vUv;
            vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
            vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
            vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }
            float snoise(vec2 v) {
                const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);
                vec2 i  = floor(v + dot(v, C.yy) );
                vec2 x0 = v - i + dot(i, C.xx);
                vec2 i1; i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
                vec4 x12 = x0.xyxy + C.xxzz; x12.xy -= i1;
                i = mod289(i);
                vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));
                vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
                m = m*m ; m = m*m ;
                vec3 x = 2.0 * fract(p * C.www) - 1.0;
                vec3 h = abs(x) - 0.5;
                vec3 ox = floor(x + 0.5);
                vec3 a0 = x - ox;
                m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
                vec3 g; g.x  = a0.x  * x0.x  + h.x  * x0.y; g.yz = a0.yz * x12.xz + h.yz * x12.yw;
                return 130.0 * dot(m, g);
            }
            void main() {
                float n = snoise(vUv * 6.0 + time * 0.2);
                vec3 colorA = vec3(1.0, 0.5, 0.0); vec3 colorB = vec3(1.0, 0.9, 0.1);
                vec3 finalColor = mix(colorA, colorB, n * 0.5 + 0.5);
                gl_FragColor = vec4(finalColor + vec3(0.1), 1.0);
            }
        `;
        const atmoVertex = `varying vec3 vNormal; void main() { vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`;
        const atmoFragment = `varying vec3 vNormal; uniform vec3 glowColor; void main() { float intensity = pow(0.6 - dot(vNormal, vec3(0, 0, 1.0)), 3.0); gl_FragColor = vec4(glowColor, 1.0) * intensity * 1.5; }`;

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0004);
            clock = new THREE.Clock();

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 5000);
            camera.position.set(0, 80, 800);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            const ambient = new THREE.AmbientLight(0x333333);
            scene.add(ambient);
            const sunLight = new THREE.PointLight(0xffffff, 1.5, 2000);
            scene.add(sunLight);

            createSun();
            createPlanets();
            createComets();
            createMassiveStarfield();

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            window.addEventListener('resize', onResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('click', onClick);

            animate();
            
            setTimeout(() => {
                document.getElementById('loader').style.opacity = 0;
                setTimeout(() => document.getElementById('loader').remove(), 1000);
            }, 1000);
        }

        // --- OBJECTS ---
        function createSun() {
            const geo = new THREE.SphereGeometry(CONFIG.sunSize, 64, 64);
            const mat = new THREE.ShaderMaterial({ uniforms: { time: { value: 0 } }, vertexShader: sunVertex, fragmentShader: sunFragment });
            sunMesh = new THREE.Mesh(geo, mat);
            scene.add(sunMesh);

            const spriteMat = new THREE.SpriteMaterial({ map: createGlowTexture(255, 120, 0), color: 0xffaa00, blending: THREE.AdditiveBlending, transparent: true });
            const sprite = new THREE.Sprite(spriteMat);
            sprite.scale.set(CONFIG.sunSize*4.5, CONFIG.sunSize*4.5, 1);
            sunMesh.add(sprite);
        }

        function createPlanetTexture(type, colorHex) {
            const size = 512;
            const canvas = document.createElement('canvas'); canvas.width = size; canvas.height = size/2;
            const ctx = canvas.getContext('2d'); const w = size; const h = size/2;
            ctx.fillStyle = '#' + colorHex.toString(16).padStart(6, '0'); ctx.fillRect(0,0,w,h);
            if (type === 'gas' || type === 'jupiter') {
                for(let i=0; i<30; i++) { ctx.fillStyle = `rgba(255,255,255, ${Math.random()*0.15})`; ctx.fillRect(0, Math.random()*h, w, Math.random()*40+5); }
            } else if (type === 'earth') {
                ctx.fillStyle = '#004499'; ctx.fillRect(0,0,w,h);
                for(let i=0; i<200; i++) { ctx.beginPath(); ctx.arc(Math.random()*w, Math.random()*h, Math.random()*30, 0, Math.PI*2); ctx.fillStyle = `rgba(40, 180, 40, 0.7)`; ctx.fill(); }
                for(let i=0; i<300; i++) { ctx.beginPath(); ctx.arc(Math.random()*w, Math.random()*h, Math.random()*20, 0, Math.PI*2); ctx.fillStyle = `rgba(255,255,255, 0.2)`; ctx.fill(); }
            } else {
                for(let i=0; i<400; i++) { ctx.beginPath(); ctx.arc(Math.random()*w, Math.random()*h, Math.random()*10, 0, Math.PI*2); ctx.fillStyle = `rgba(0,0,0,0.15)`; ctx.fill(); }
            }
            return new THREE.CanvasTexture(canvas);
        }

        function createPlanets() {
            const hud = document.getElementById('hud-layer');
            PLANETS.forEach(p => {
                const grp = new THREE.Group();
                grp.userData = { type: 'planet', id: p.id, name: p.name };
                
                const mat = new THREE.MeshStandardMaterial({ map: createPlanetTexture(p.type, p.color), roughness: 0.8 });
                const mesh = new THREE.Mesh(new THREE.SphereGeometry(p.radius, 64, 64), mat);
                grp.add(mesh);

                const atmo = new THREE.Mesh(new THREE.SphereGeometry(p.radius*1.15, 64, 64), 
                    new THREE.ShaderMaterial({ uniforms: { glowColor: { value: new THREE.Color(p.color) } }, vertexShader: atmoVertex, fragmentShader: atmoFragment, side: THREE.BackSide, blending: THREE.AdditiveBlending, transparent: true }));
                mesh.add(atmo);

                if (p.type === 'jupiter') {
                     const ring = new THREE.Mesh(new THREE.RingGeometry(p.radius*1.4, p.radius*2.2, 64), new THREE.MeshBasicMaterial({ color: 0xaa8866, side: THREE.DoubleSide, transparent: true, opacity: 0.3 }));
                     ring.rotation.x = Math.PI/2.2; mesh.add(ring);
                }
                const path = new THREE.Mesh(new THREE.RingGeometry(p.dist-0.2, p.dist+0.2, 128), new THREE.MeshBasicMaterial({ color: 0x333333, side: THREE.DoubleSide, transparent: true, opacity: 0.3 }));
                path.rotation.x = Math.PI/2; scene.add(path);
                grp.position.x = p.dist;
                scene.add(grp);

                const el = document.createElement('div'); el.className = 'planet-tracker';
                el.innerHTML = `<div class="tracker-label" onclick="openModal('${p.id}', '${p.name}')">${p.name}</div><div class="tracker-line"></div>`;
                hud.appendChild(el);

                planetsMesh.push({ mesh, group: grp, data: p, angle: Math.random()*Math.PI*2, el });
            });
        }

        // --- COMETS FIX ---
        function createComets() {
            const hud = document.getElementById('hud-layer');
            COMETS.forEach(c => {
                const group = new THREE.Group();
                group.userData = { type: 'comet', url: c.url };

                const headGeo = new THREE.SphereGeometry(2.5, 32, 32); // Slightly larger head
                const headMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
                const head = new THREE.Mesh(headGeo, headMat);
                group.add(head);

                const spriteMat = new THREE.SpriteMaterial({ map: createGlowTexture(255, 255, 255), color: c.color, blending: THREE.AdditiveBlending });
                const sprite = new THREE.Sprite(spriteMat);
                sprite.scale.set(20, 20, 1);
                head.add(sprite);

                const tailGeo = new THREE.CylinderGeometry(0.8, 6, 45, 32, 1, true); // Longer tail
                tailGeo.translate(0, -22.5, 0); 
                const tailMat = new THREE.MeshBasicMaterial({ map: createCometTailTexture(c.tailColor), transparent: true, opacity: 0.9, side: THREE.DoubleSide, blending: THREE.AdditiveBlending, depthWrite: false });
                const tail = new THREE.Mesh(tailGeo, tailMat);
                group.add(tail);
                
                scene.add(group);

                const el = document.createElement('div');
                el.className = 'comet-tracker';
                if(c.id === 'linkedin') el.classList.add('blue');
                el.innerHTML = `<div class="comet-label">${c.label}</div>`;
                hud.appendChild(el);

                cometsMesh.push({ mesh: group, data: c, angle: c.offset, el: el });
            });
        }

        function createCometTailTexture(colorStr) {
            const c = document.createElement('canvas'); c.width = 64; c.height = 256;
            const ctx = c.getContext('2d');
            const gr = ctx.createLinearGradient(0, 0, 0, 256);
            gr.addColorStop(0, 'rgba(255, 255, 255, 1)'); 
            gr.addColorStop(0.3, colorStr);
            gr.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = gr; ctx.fillRect(0,0,64,256);
            return new THREE.CanvasTexture(c);
        }

        function createGlowTexture(r, g, b) {
            const c = document.createElement('canvas'); c.width=64; c.height=64;
            const ctx = c.getContext('2d');
            const gr = ctx.createRadialGradient(32,32,0,32,32,32);
            gr.addColorStop(0, `rgba(${r},${g},${b},1)`);
            gr.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = gr; ctx.fillRect(0,0,64,64);
            return new THREE.CanvasTexture(c);
        }

        function createMassiveStarfield() {
            const dustGeo = new THREE.BufferGeometry(); const dustPos = [];
            for(let i=0; i<10000; i++) dustPos.push((Math.random()-0.5)*4000, (Math.random()-0.5)*2000, (Math.random()-0.5)*4000);
            dustGeo.setAttribute('position', new THREE.Float32BufferAttribute(dustPos, 3));
            const dustSystem = new THREE.Points(dustGeo, new THREE.PointsMaterial({ size: 0.6, color: 0x5588aa, transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending }));
            scene.add(dustSystem); starGroups.push({ mesh: dustSystem, speed: 0.005 }); 

            const starGeo = new THREE.BufferGeometry(); const starPos = [], starCol = [];
            for(let i=0; i<5000; i++) {
                starPos.push((Math.random()-0.5)*3000, (Math.random()-0.5)*3000, (Math.random()-0.5)*3000);
                const c = new THREE.Color(); c.setHSL(Math.random(), 0.5, Math.random()*0.5 + 0.5); starCol.push(c.r, c.g, c.b);
            }
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3)); starGeo.setAttribute('color', new THREE.Float32BufferAttribute(starCol, 3));
            const starSystem = new THREE.Points(starGeo, new THREE.PointsMaterial({ size: 1.5, vertexColors: true, map: createGlowTexture(255,255,255), blending: THREE.AdditiveBlending, transparent: true }));
            scene.add(starSystem); starGroups.push({ mesh: starSystem, speed: 0.01 });
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime(); // Use Absolute Time for Comets
            const delta = clock.getDelta();

            sunMesh.material.uniforms.time.value = time;
            starGroups.forEach(s => { s.mesh.rotation.y += s.speed * delta; });

            if (!isPaused) {
                // Planets
                planetsMesh.forEach(o => {
                    o.angle += o.data.speed * CONFIG.orbitSpeed * 0.1;
                    o.group.position.x = Math.cos(o.angle) * o.data.dist;
                    o.group.position.z = Math.sin(o.angle) * o.data.dist;
                    o.mesh.rotation.y += 0.5 * delta;
                });
                
                // COMETS: Forced movement based on 'time' to prevent stucking
                cometsMesh.forEach(c => {
                    // Calculate angle based on absolute time
                    const orbitTime = time * 0.5; // Speed multiplier
                    const currentAngle = c.angle + orbitTime; 

                    const x = Math.cos(currentAngle) * c.data.distX;
                    const z = Math.sin(currentAngle) * c.data.distZ;
                    const y = Math.sin(currentAngle) * 30 * (c.data.id === 'linkedin' ? 1 : -1); 
                    
                    c.mesh.position.set(x, y, z);

                    // LookAt Logic
                    const nextAngle = currentAngle + 0.1;
                    const nextPos = new THREE.Vector3(
                         Math.cos(nextAngle) * c.data.distX,
                         Math.sin(nextAngle) * 30 * (c.data.id === 'linkedin' ? 1 : -1),
                         Math.sin(nextAngle) * c.data.distZ
                    );
                    const velocity = nextPos.sub(c.mesh.position).normalize();
                    const target = c.mesh.position.clone().sub(velocity);
                    c.mesh.lookAt(target);
                    c.mesh.rotateX(-Math.PI/2);
                });

            } else {
                planetsMesh.forEach(o => o.mesh.rotation.y += 0.1 * delta);
            }

            const targetZ = CONFIG.camZ;
            if (camera.position.z > targetZ + 1) {
                camera.position.z += (targetZ - camera.position.z) * 0.02;
                camera.position.y += (80 - camera.position.y) * 0.02;
            } else if (!isPaused) {
                camera.position.x += (mouse.x * 30 - camera.position.x) * 0.05;
                camera.position.y += (80 + mouse.y * 30 - camera.position.y) * 0.05;
            }
            camera.lookAt(0,0,0);

            updateHUD();
            renderer.render(scene, camera);
        }

        function updateHUD() {
            planetsMesh.forEach(o => {
                const v = o.group.position.clone(); v.y += o.data.radius; v.project(camera);
                if (v.z > 1) { o.el.style.opacity = 0; } else {
                    const x = (v.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-(v.y * 0.5) + 0.5) * window.innerHeight;
                    o.el.style.left = `${x}px`; o.el.style.top = `${y}px`;
                    o.el.style.opacity = isPaused ? 0.2 : 1;
                }
            });
            cometsMesh.forEach(c => {
                 const v = c.mesh.position.clone(); v.project(camera);
                 if (v.z > 1) { c.el.style.opacity = 0; } else {
                    const x = (v.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (-(v.y * 0.5) + 0.5) * window.innerHeight;
                    c.el.style.left = `${x}px`; c.el.style.top = `${y}px`;
                 }
            });
        }

        function onMouseMove(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1; mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            
            const objectsToCheck = [];
            planetsMesh.forEach(p => objectsToCheck.push(p.group));
            cometsMesh.forEach(c => objectsToCheck.push(c.mesh));

            const hits = raycaster.intersectObjects(objectsToCheck, true);
            cometsMesh.forEach(c => c.el.style.opacity = 0);

            if (hits.length > 0) {
                document.body.style.cursor = 'pointer';
                let obj = hits[0].object;
                while(obj.parent && obj.parent.type !== 'Scene') {
                    if (obj.userData && (obj.userData.type === 'comet' || obj.userData.type === 'planet')) break;
                    obj = obj.parent;
                }
                if (obj.userData.type === 'comet') {
                    const cometData = cometsMesh.find(c => c.data.url === obj.userData.url);
                    if(cometData) cometData.el.style.opacity = 1;
                }
            } else {
                document.body.style.cursor = 'default';
            }
        }

        function onClick() {
            if (isPaused) return;
            raycaster.setFromCamera(mouse, camera);
            const objectsToCheck = [];
            planetsMesh.forEach(p => objectsToCheck.push(p.group));
            cometsMesh.forEach(c => objectsToCheck.push(c.mesh));

            const hits = raycaster.intersectObjects(objectsToCheck, true);
            if (hits.length > 0) {
                let obj = hits[0].object;
                while(obj.parent && obj.parent.type !== 'Scene') {
                    if (obj.userData && (obj.userData.type === 'comet' || obj.userData.type === 'planet')) break;
                    obj = obj.parent;
                }
                if (obj.userData.type === 'planet') openModal(obj.userData.id, obj.userData.name);
                else if (obj.userData.type === 'comet') window.open(obj.userData.url, '_blank');
            }
        }

        window.openModal = function(id, title) {
            isPaused = true;
            document.getElementById('modal-body').innerHTML = document.getElementById(`data-${id}`).innerHTML;
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal').classList.add('active');
            document.getElementById('hud-layer').style.opacity = 0;
        }

        window.closeModal = function() {
            document.getElementById('modal').classList.remove('active');
            document.getElementById('hud-layer').style.opacity = 1;
            isPaused = false;
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
    </script>
</body>
</html>
